"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[98],{691(e,i,r){r.r(i),r.d(i,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"discovery","title":"4. Discovery Protocol","description":"Discovery enables agents to find context providers they have never interacted with before, without gatekeepers or centralized control.","source":"@site/docs/discovery.md","sourceDirName":".","slug":"/discovery","permalink":"/lcp-spec/docs/discovery","draft":false,"unlisted":false,"editUrl":"https://github.com/Turf-Tech/lcp-spec/tree/main/website/docs/discovery.md","tags":[],"version":"current","lastUpdatedBy":"code-wiki","lastUpdatedAt":1770211386000,"sidebarPosition":5,"frontMatter":{"sidebar_position":5,"sidebar_label":"Discovery Protocol"},"sidebar":"docsSidebar","previous":{"title":"Core Components","permalink":"/lcp-spec/docs/core-components"},"next":{"title":"Negotiation Protocol","permalink":"/lcp-spec/docs/negotiation"}}');var s=r(4848),t=r(8453);const l={sidebar_position:5,sidebar_label:"Discovery Protocol"},a="4. Discovery Protocol",c={},o=[{value:"4.1 Design Goals",id:"41-design-goals",level:2},{value:"4.2 Registry Architecture",id:"42-registry-architecture",level:2},{value:"Registry Types",id:"registry-types",level:3},{value:"4.2.1 Decentralized Hash Table (DHT)",id:"421-decentralized-hash-table-dht",level:4},{value:"4.2.2 On-Chain Registry",id:"422-on-chain-registry",level:4},{value:"4.2.3 Federated Registry",id:"423-federated-registry",level:4},{value:"Registry Interface",id:"registry-interface",level:3},{value:"4.3 Publishing Capabilities",id:"43-publishing-capabilities",level:2},{value:"Publication Flow",id:"publication-flow",level:3},{value:"Publication Request",id:"publication-request",level:3},{value:"Validation Requirements",id:"validation-requirements",level:3},{value:"Publication Costs",id:"publication-costs",level:3},{value:"4.4 Querying Capabilities",id:"44-querying-capabilities",level:2},{value:"Query Structure",id:"query-structure",level:3},{value:"Filter Types",id:"filter-types",level:3},{value:"Query Optimization",id:"query-optimization",level:3},{value:"Indexed Fields",id:"indexed-fields",level:4},{value:"Bloom Filters",id:"bloom-filters",level:4},{value:"Caching",id:"caching",level:4},{value:"4.5 Ranking and Reputation",id:"45-ranking-and-reputation",level:2},{value:"Ranking Formula",id:"ranking-formula",level:3},{value:"Reputation Integration",id:"reputation-integration",level:3},{value:"4.6 Multi-Registry Discovery",id:"46-multi-registry-discovery",level:2},{value:"Parallel Query Strategy",id:"parallel-query-strategy",level:3},{value:"Deduplication",id:"deduplication",level:3},{value:"4.7 Discovery Privacy",id:"47-discovery-privacy",level:2},{value:"Privacy-Preserving Techniques",id:"privacy-preserving-techniques",level:3},{value:"Private Information Retrieval (PIR)",id:"private-information-retrieval-pir",level:4},{value:"Query Obfuscation",id:"query-obfuscation",level:4},{value:"Tor/Mixnet Routing",id:"tormixnet-routing",level:4},{value:"4.8 Discovery Anti-Patterns",id:"48-discovery-anti-patterns",level:2},{value:"Sybil Attacks",id:"sybil-attacks",level:3},{value:"Eclipse Attacks",id:"eclipse-attacks",level:3},{value:"Spam/DoS",id:"spamdos",level:3},{value:"4.9 Implementation Recommendations",id:"49-implementation-recommendations",level:2},{value:"For Providers",id:"for-providers",level:3},{value:"For Consumers",id:"for-consumers",level:3},{value:"For Registry Operators",id:"for-registry-operators",level:3}];function d(e){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"4-discovery-protocol",children:"4. Discovery Protocol"})}),"\n",(0,s.jsx)(i.p,{children:"Discovery enables agents to find context providers they have never interacted with before, without gatekeepers or centralized control."}),"\n",(0,s.jsx)(i.h2,{id:"41-design-goals",children:"4.1 Design Goals"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Permissionless Participation"}),": Any provider can advertise capabilities; any consumer can query"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Censorship Resistance"}),": No single entity can prevent discovery of legitimate providers"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Efficient Querying"}),": Consumers can filter large provider sets without exhaustive search"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Reputation Integration"}),": Discovery results can be ranked by cryptographic reputation"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Freshness Guarantees"}),": Stale capability descriptors are automatically expired"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"42-registry-architecture",children:"4.2 Registry Architecture"}),"\n",(0,s.jsx)(i.p,{children:"LCP supports multiple registry implementations. Each provides the same logical interface but differs in trust assumptions and operational characteristics."}),"\n",(0,s.jsx)(i.h3,{id:"registry-types",children:"Registry Types"}),"\n",(0,s.jsx)(i.h4,{id:"421-decentralized-hash-table-dht",children:"4.2.1 Decentralized Hash Table (DHT)"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Architecture"}),": Kademlia-style DHT where capability descriptors are stored at keys derived from capability type hashes."]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Properties"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Fully decentralized, no central coordination"}),"\n",(0,s.jsx)(i.li,{children:"Censorship-resistant through redundancy"}),"\n",(0,s.jsx)(i.li,{children:"Eventually consistent (stale data possible)"}),"\n",(0,s.jsx)(i.li,{children:"Lower query latency for specific capability types"}),"\n",(0,s.jsx)(i.li,{children:"NAT traversal complexity"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Use Cases"}),": Public, permissionless discovery with maximum censorship resistance"]}),"\n",(0,s.jsx)(i.h4,{id:"422-on-chain-registry",children:"4.2.2 On-Chain Registry"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Architecture"}),": Smart contract on public blockchain (e.g., Ethereum, Polygon) storing provider capability hashes with IPFS/Arweave pointers for full descriptors."]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Properties"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Cryptographic immutability and audit trail"}),"\n",(0,s.jsx)(i.li,{children:"Integrated with on-chain reputation (ERC-8004)"}),"\n",(0,s.jsx)(i.li,{children:"Higher query cost (blockchain RPC calls)"}),"\n",(0,s.jsx)(i.li,{children:"Settlement-ready (provider addresses already on-chain)"}),"\n",(0,s.jsx)(i.li,{children:"Global consistency"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Use Cases"}),": High-value transactions requiring strongest guarantees and settlement integration"]}),"\n",(0,s.jsx)(i.h4,{id:"423-federated-registry",children:"4.2.3 Federated Registry"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Architecture"}),": Multiple registry operators maintain synchronized indices, each with independent governance."]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Properties"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Balanced decentralization (multiple operators, not fully P2P)"}),"\n",(0,s.jsx)(i.li,{children:"Lower query latency than blockchain"}),"\n",(0,s.jsx)(i.li,{children:"Operators can implement custom filtering/curation"}),"\n",(0,s.jsx)(i.li,{children:"Requires trust in at least one federation member"}),"\n",(0,s.jsx)(i.li,{children:"Faster capability updates"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Use Cases"}),": Enterprise deployments, domain-specific ecosystems, latency-sensitive applications"]}),"\n",(0,s.jsx)(i.h3,{id:"registry-interface",children:"Registry Interface"}),"\n",(0,s.jsx)(i.p,{children:"All registries MUST implement this logical interface:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-typescript",children:"interface Registry {\n  // Publish a capability descriptor\n  publish(descriptor: ProviderCapabilityDescriptor): Promise<PublishReceipt>\n\n  // Query for capabilities matching filters\n  query(filters: QueryFilters): Promise<CapabilityDescriptor[]>\n\n  // Retrieve specific capability by ID\n  get(capabilityId: string): Promise<CapabilityDescriptor | null>\n\n  // Update existing capability\n  update(capabilityId: string, descriptor: ProviderCapabilityDescriptor): Promise<UpdateReceipt>\n\n  // Remove capability from registry\n  remove(capabilityId: string): Promise<RemovalReceipt>\n}\n"})}),"\n",(0,s.jsx)(i.h2,{id:"43-publishing-capabilities",children:"4.3 Publishing Capabilities"}),"\n",(0,s.jsx)(i.h3,{id:"publication-flow",children:"Publication Flow"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"Provider                    Registry\n    \u2502                           \u2502\n    \u2502\u2500\u2500publish(descriptor)\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n    \u2502                           \u2502\n    \u2502                           \u251c\u2500 Validate descriptor schema\n    \u2502                           \u251c\u2500 Verify provider signature\n    \u2502                           \u251c\u2500 Check reputation (optional)\n    \u2502                           \u251c\u2500 Store descriptor\n    \u2502                           \u251c\u2500 Index by capability type\n    \u2502                           \u2502\n    \u2502\u25c0\u2500\u2500PublishReceipt\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n    \u2502  - descriptor_id          \u2502\n    \u2502  - registry_location      \u2502\n    \u2502  - expires_at             \u2502\n"})}),"\n",(0,s.jsx)(i.h3,{id:"publication-request",children:"Publication Request"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-json",children:'{\n  "action": "publish",\n  "descriptor": {\n    // Full ProviderCapabilityDescriptor (see 3.1)\n  },\n  "signature": {\n    "algorithm": "ES256K",\n    "public_key": "0xabcd...ef01",\n    "signature_value": "0x3045..."\n  },\n  "metadata": {\n    "timestamp": "2026-01-29T12:00:00Z",\n    "ttl_hours": 720  // 30 days\n  }\n}\n'})}),"\n",(0,s.jsx)(i.h3,{id:"validation-requirements",children:"Validation Requirements"}),"\n",(0,s.jsx)(i.p,{children:"Registries MUST validate:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Schema Compliance"}),": Descriptor matches required schema"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Signature Verification"}),": Descriptor signed by provider.id DID"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Uniqueness"}),": capability_id not already registered by different provider"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Expiry"}),": metadata.expires_at is in the future"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Registries MAY validate:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Reputation Threshold"}),": Provider meets minimum reputation score"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Stake Requirement"}),": Provider has bonded assets (slashable for fraud)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Rate Limits"}),": Provider hasn't exceeded publication rate limits"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"publication-costs",children:"Publication Costs"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"DHT"}),": Negligible (network bandwidth only)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"On-Chain"}),": Gas fees for smart contract storage (mitigated by storing hash + IPFS pointer)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Federated"}),": Operator-defined (possibly free for basic listings, fee for premium placement)"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"44-querying-capabilities",children:"4.4 Querying Capabilities"}),"\n",(0,s.jsx)(i.h3,{id:"query-structure",children:"Query Structure"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-json",children:'{\n  "filters": {\n    "capability_type": "market_data",\n    "coverage": {\n      "markets": ["NYSE", "NASDAQ"]\n    },\n    "max_price": {\n      "amount": 0.002,\n      "currency": "USDC"\n    },\n    "min_guarantees": {\n      "latency_ms": 200,\n      "availability": 0.999\n    },\n    "min_reputation_score": 8.0,\n    "settlement_chains": ["ethereum", "polygon"]\n  },\n  "sort": {\n    "by": "reputation_score",\n    "order": "descending"\n  },\n  "pagination": {\n    "limit": 50,\n    "offset": 0\n  }\n}\n'})}),"\n",(0,s.jsx)(i.h3,{id:"filter-types",children:"Filter Types"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Exact Match Filters"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"capability_type"}),": Must exactly match"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"settlement_chains"}),": At least one chain must be supported"]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Range Filters"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"max_price"}),": Provider price \u2264 specified amount"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"min_guarantees"}),": Provider guarantees \u2265 specified values"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"min_reputation_score"}),": Provider reputation \u2265 threshold"]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Set Filters"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"coverage.markets"}),": Provider covers at least one specified market"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"coverage.symbols"}),": Provider supports requested symbols"]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Boolean Filters"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"negotiable_pricing"}),": Only show providers open to negotiation"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"escrow_supported"}),": Only show providers supporting escrow"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"query-optimization",children:"Query Optimization"}),"\n",(0,s.jsx)(i.h4,{id:"indexed-fields",children:"Indexed Fields"}),"\n",(0,s.jsx)(i.p,{children:"Registries SHOULD index these fields for fast querying:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"capability_type"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"pricing.model"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"provider.reputation.score"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"terms.settlement.supported_chains"})}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"bloom-filters",children:"Bloom Filters"}),"\n",(0,s.jsx)(i.p,{children:"For large-scale DHT implementations, use Bloom filters for approximate membership testing:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'Query: "Does provider support symbol AAPL?"\n\u2192 Check Bloom filter before fetching full descriptor\n\u2192 Reduces network roundtrips by ~90% for negative results\n'})}),"\n",(0,s.jsx)(i.h4,{id:"caching",children:"Caching"}),"\n",(0,s.jsxs)(i.p,{children:["Consumers SHOULD cache capability descriptors until ",(0,s.jsx)(i.code,{children:"metadata.expires_at"}),":"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-typescript",children:"interface CapabilityCache {\n  get(capabilityId: string): CapabilityDescriptor | null\n  set(capabilityId: string, descriptor: CapabilityDescriptor, ttl: number): void\n  invalidate(capabilityId: string): void\n}\n"})}),"\n",(0,s.jsx)(i.h2,{id:"45-ranking-and-reputation",children:"4.5 Ranking and Reputation"}),"\n",(0,s.jsx)(i.p,{children:"Discovery results SHOULD be ranked by composite scores combining multiple factors."}),"\n",(0,s.jsx)(i.h3,{id:"ranking-formula",children:"Ranking Formula"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"score = w1 * reputation_score\n      + w2 * (1 - normalized_price)\n      + w3 * availability\n      + w4 * recency_factor\n      - w5 * latency_penalty\n"})}),"\n",(0,s.jsx)(i.p,{children:"Where:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"w1...w5"}),": Configurable weights (consumer preference)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"reputation_score"}),": From reputation registry (0-10)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"normalized_price"}),": Price relative to market average (0-1)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"availability"}),": Provider uptime SLA (0-1)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"recency_factor"}),": How recently descriptor was updated (0-1, decay function)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"latency_penalty"}),": Expected query latency impact (0-1)"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"reputation-integration",children:"Reputation Integration"}),"\n",(0,s.jsx)(i.p,{children:"LCP integrates with on-chain reputation systems (e.g., ERC-8004):"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-json",children:'{\n  "provider": {\n    "id": "did:example:provider123",\n    "reputation": {\n      "registry": "ethereum:0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",\n      "score": 8.7,\n      "transactions": 15234,\n      "positive_feedback_ratio": 0.987,\n      "uptime_30d": 0.9987,\n      "last_updated": "2026-01-29T10:00:00Z"\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(i.p,{children:"Consumers can verify reputation claims by querying the registry contract directly:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-solidity",children:"interface IReputationRegistry {\n  function getProviderScore(address provider) external view returns (uint256);\n  function getTransactionCount(address provider) external view returns (uint256);\n  function getFeedbackRatio(address provider) external view returns (uint256);\n}\n"})}),"\n",(0,s.jsx)(i.h2,{id:"46-multi-registry-discovery",children:"4.6 Multi-Registry Discovery"}),"\n",(0,s.jsx)(i.p,{children:"Agents often query multiple registries simultaneously for maximum coverage."}),"\n",(0,s.jsx)(i.h3,{id:"parallel-query-strategy",children:"Parallel Query Strategy"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-typescript",children:"async function discoverCapabilities(filters: QueryFilters): Promise<CapabilityDescriptor[]> {\n  const registries = [\n    dhtRegistry,\n    ethereumRegistry,\n    polygonRegistry,\n    federatedRegistry\n  ]\n\n  // Query all registries concurrently\n  const results = await Promise.allSettled(\n    registries.map(r => r.query(filters))\n  )\n\n  // Merge results, de-duplicate by capability_id\n  const merged = deduplicateByCapabilityId(\n    results.flatMap(r => r.status === 'fulfilled' ? r.value : [])\n  )\n\n  // Re-rank combined results\n  return rankByScore(merged, filters.sort)\n}\n"})}),"\n",(0,s.jsx)(i.h3,{id:"deduplication",children:"Deduplication"}),"\n",(0,s.jsx)(i.p,{children:"When the same capability appears in multiple registries:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Prefer on-chain"}),": On-chain registrations are authoritative (immutable, auditable)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Check freshness"}),": Use descriptor with most recent ",(0,s.jsx)(i.code,{children:"metadata.published_at"})]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Verify consistency"}),": If descriptors differ significantly, flag as suspicious"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"47-discovery-privacy",children:"4.7 Discovery Privacy"}),"\n",(0,s.jsx)(i.p,{children:"Some discovery queries reveal agent intent and can leak information."}),"\n",(0,s.jsx)(i.h3,{id:"privacy-preserving-techniques",children:"Privacy-Preserving Techniques"}),"\n",(0,s.jsx)(i.h4,{id:"private-information-retrieval-pir",children:"Private Information Retrieval (PIR)"}),"\n",(0,s.jsx)(i.p,{children:"Agent retrieves capability descriptors without revealing which ones it's interested in:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"Agent wants capability X from registry with 1000 descriptors\n\u2192 Download all 1000 descriptors (or use PIR protocol)\n\u2192 Filter locally\n\u2192 No registry operator learns which capability was requested\n"})}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Trade-off"}),": Higher bandwidth (download all descriptors vs. targeted query)"]}),"\n",(0,s.jsx)(i.h4,{id:"query-obfuscation",children:"Query Obfuscation"}),"\n",(0,s.jsx)(i.p,{children:"Add noise queries to hide true intent:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-typescript",children:"function obfuscatedQuery(realFilters: QueryFilters): Promise<CapabilityDescriptor[]> {\n  const noiseQueries = generatePlausibleNoiseQueries(3)\n  const allQueries = [realFilters, ...noiseQueries]\n\n  const results = await Promise.all(\n    allQueries.map(q => registry.query(q))\n  )\n\n  return results[0]  // Return only real results\n}\n"})}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Trade-off"}),": 4x query cost to hide intent"]}),"\n",(0,s.jsx)(i.h4,{id:"tormixnet-routing",children:"Tor/Mixnet Routing"}),"\n",(0,s.jsx)(i.p,{children:"Route discovery queries through anonymity networks:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Prevents registry from associating queries with agent IP"}),"\n",(0,s.jsx)(i.li,{children:"Adds latency (~2-5s for Tor)"}),"\n",(0,s.jsx)(i.li,{children:"Suitable for non-latency-sensitive discovery"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"48-discovery-anti-patterns",children:"4.8 Discovery Anti-Patterns"}),"\n",(0,s.jsx)(i.h3,{id:"sybil-attacks",children:"Sybil Attacks"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Attack"}),": Adversary creates many fake provider identities to dominate discovery results."]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Mitigation"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Reputation systems with verification history (can't be instantly fabricated)"}),"\n",(0,s.jsx)(i.li,{children:"Staking requirements (economic cost to create identities)"}),"\n",(0,s.jsx)(i.li,{children:"Social graph analysis (isolated identities are suspicious)"}),"\n",(0,s.jsx)(i.li,{children:"Proof-of-work for registration (rate-limit identity creation)"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"eclipse-attacks",children:"Eclipse Attacks"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Attack"}),": Adversary controls all registry nodes agent connects to, hiding legitimate providers."]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Mitigation"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Query multiple independent registries (on-chain + DHT + federated)"}),"\n",(0,s.jsx)(i.li,{children:"Use trusted bootstrap nodes for DHT"}),"\n",(0,s.jsx)(i.li,{children:"Cross-check results across registries"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"spamdos",children:"Spam/DoS"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Attack"}),": Flood registry with fake capability descriptors."]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Mitigation"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Descriptor size limits (e.g., max 10KB)"}),"\n",(0,s.jsx)(i.li,{children:"Publication rate limits per provider"}),"\n",(0,s.jsx)(i.li,{children:"Stake forfeiture for spam (on-chain registries)"}),"\n",(0,s.jsx)(i.li,{children:"Bloom filters to reject known spam patterns"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"49-implementation-recommendations",children:"4.9 Implementation Recommendations"}),"\n",(0,s.jsx)(i.h3,{id:"for-providers",children:"For Providers"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Publish to multiple registries"}),": On-chain (authoritative) + DHT (fast) + federated (enterprise)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Keep descriptors fresh"}),": Update before expiry to maintain visibility"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Accurate guarantees"}),": Overpromising damages reputation more than conservative claims"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Competitive pricing"}),": Monitor market rates and adjust dynamically"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"for-consumers",children:"For Consumers"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Query multiple registries"}),": Don't rely on single source"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Cache aggressively"}),": Respect ",(0,s.jsx)(i.code,{children:"expires_at"})," to reduce query overhead"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Verify reputation on-chain"}),": Don't trust self-reported scores"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Filter early"}),": Apply hard requirements (price, latency) before ranking"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"for-registry-operators",children:"For Registry Operators"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Schema validation"}),": Reject malformed descriptors immediately"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Expiry enforcement"}),": Automatically prune expired descriptors"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Rate limiting"}),": Prevent spam without blocking legitimate updates"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Monitoring"}),": Track query patterns for abuse detection"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,i,r){r.d(i,{R:()=>l,x:()=>a});var n=r(6540);const s={},t=n.createContext(s);function l(e){const i=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),n.createElement(t.Provider,{value:i},e.children)}}}]);